<%- include('partials/header') %>
<body>
  <%- include('partials/navbar') %>

  <main class="main" role="main">
    <div class="container">

      <!-- token CSRF dispon칤vel para o JS (se a rota fornecer csrfToken) -->
      <% if (typeof csrfToken !== 'undefined') { %>
        <meta name="csrf-token" content="<%= csrfToken %>">
      <% } %>

      <div style="margin-bottom: 2rem;">
        <h1 style="font-size: 2rem; font-weight: 700; margin-bottom: 0.5rem;">Novo Contato</h1>
        <p style="color: var(--text-secondary);">Registre uma nova liga칞칚o ou contato</p>
      </div>

      <div style="max-width: 800px;">
        <form id="formNovoRecado" class="card">
          <div class="card-header">
            <h2 class="card-title">Informa칞칫es do Contato</h2>
            <p class="card-subtitle">Preencha todos os campos obrigat칩rios</p>
          </div>

          <div class="card-body">
            <fieldset style="border: 1px solid var(--border-light); border-radius: var(--radius); padding: 1.5rem; margin-bottom: 2rem;">
              <legend style="padding: 0 0.5rem; font-weight: 600; color: var(--text-primary);">游 Dados da Liga칞칚o</legend>
              <div class="form-grid-2">
                <div class="form-group">
                  <label for="call_date" class="form-label required">Data da Liga칞칚o</label>
                  <input id="call_date" name="call_date" type="date" class="form-input" required data-label="Data da liga칞칚o" autocomplete="bday" />
                </div>
                <div class="form-group">
                  <label for="call_time" class="form-label required">Hora da Liga칞칚o</label>
                  <input id="call_time" name="call_time" type="time" class="form-input" required data-label="Hora da liga칞칚o" autocomplete="off" />
                </div>
              </div>

              <div class="form-group">
                <label for="recipientType" class="form-label required">Tipo de destinat치rio</label>
                <select id="recipientType" name="recipientType" class="form-select" data-label="Tipo de destinat치rio" autocomplete="off">
                  <option value="user" selected>Usu치rio espec칤fico</option>
                  <option value="sector">Setor</option>
                </select>
                <div class="form-help">Escolha se o contato ser치 direcionado a uma pessoa espec칤fica ou a todo um setor.</div>
              </div>

              <div class="form-group" id="recipientUserGroup">
                <label for="recipientUserId" class="form-label required">Usu치rio destinat치rio</label>
                <select id="recipientUserId" name="recipientUserId" class="form-select" data-label="Usu치rio destinat치rio" autocomplete="organization" required>
                  <option value="">Selecione um usu치rio</option>
                  <% (activeUsers || []).forEach(function(user) { %>
                    <option value="<%= user.id %>"><%= user.name %></option>
                  <% }); %>
                </select>
                <div class="form-help">Pessoa respons치vel por receber este contato.</div>
              </div>

              <div class="form-group d-none" id="recipientSectorGroup">
                <label for="recipientSectorId" class="form-label required">Setor destinat치rio</label>
                <select id="recipientSectorId" name="recipientSectorId" class="form-select" data-label="Setor destinat치rio" autocomplete="organization">
                  <option value="">Selecione um setor</option>
                  <% (activeSectors || []).forEach(function(sector) { %>
                    <option value="<%= sector.id %>"><%= sector.name %></option>
                  <% }); %>
                </select>
                <div class="form-help">Escolha o setor que deve visualizar este contato.</div>
              </div>

              <div class="form-group">
                <label for="visibility" class="form-label">Visibilidade</label>
                <select id="visibility" name="visibility" class="form-select" autocomplete="off">
                  <option value="private" selected>Privado (apenas destinat치rio)</option>
                  <option value="public">P칰blico (todos com acesso)</option>
                </select>
                <div class="form-help">Contatos p칰blicos ficam vis칤veis para todos com permiss칚o de leitura.</div>
              </div>
            </fieldset>

            <fieldset style="border: 1px solid var(--border-light); border-radius: var(--radius); padding: 1.5rem; margin-bottom: 2rem;">
              <legend style="padding: 0 0.5rem; font-weight: 600; color: var(--text-primary);">游녻 Dados do Remetente</legend>
              <div class="form-group">
                <label for="sender_name" class="form-label required">Nome do Remetente</label>
                <input id="sender_name" name="sender_name" type="text" class="form-input" placeholder="Nome completo de quem ligou" required data-label="Nome do remetente" autocomplete="name" />
              </div>
              <div class="form-grid-2">
                <div class="form-group">
                  <label for="sender_phone" class="form-label">Telefone</label>
                  <input id="sender_phone" name="sender_phone" type="tel" class="form-input" placeholder="(11) 99999-9999" autocomplete="tel" />
                  <div class="form-help">Telefone para retorno (opcional)</div>
                </div>
                <div class="form-group">
                  <label for="sender_email" class="form-label">E-mail</label>
                  <input id="sender_email" name="sender_email" type="email" class="form-input" placeholder="email@exemplo.com" autocomplete="email" />
                  <div class="form-help">E-mail para contato (opcional)</div>
                </div>
              </div>
              <div class="form-group">
                <label for="callback_time" class="form-label">Hor치rio para Retorno</label>
                <input id="callback_time" name="callback_time" type="text" class="form-input" placeholder="Ex: Das 9h 맙 17h, Ap칩s 14h, etc." autocomplete="off" />
                <div class="form-help">Melhor hor치rio para retornar a liga칞칚o (opcional)</div>
              </div>
            </fieldset>

            <fieldset style="border: 1px solid var(--border-light); border-radius: var(--radius); padding: 1.5rem; margin-bottom: 2rem;">
              <legend style="padding: 0 0.5rem; font-weight: 600; color: var(--text-primary);">游닇 Conte칰do do Contato</legend>
              <div class="form-group">
                <label for="subject" class="form-label required">Assunto</label>
                <input id="subject" name="subject" type="text" class="form-input" placeholder="Resumo do motivo da liga칞칚o" required data-label="Assunto" autocomplete="off" />
                <div class="form-help">Descreva brevemente o motivo da liga칞칚o</div>
              </div>
              <div class="form-group">
                <label for="notes" class="form-label">Observa칞칫es</label>
                <textarea id="notes" name="notes" class="form-textarea" rows="4" placeholder="Detalhes adicionais, contexto ou informa칞칫es importantes sobre o contato..." autocomplete="off"></textarea>
                <div class="form-help">Informa칞칫es adicionais que possam ser 칰teis (opcional)</div>
              </div>
              <div class="form-group">
                <label for="status" class="form-label">Situa칞칚o Inicial</label>
                <select id="status" name="status" class="form-select" autocomplete="off">
                  <option value="pending">Pendente</option>
                  <option value="in_progress">Em Andamento</option>
                  <option value="resolved">Resolvido</option>
                </select>
                <div class="form-help">Status atual do contato</div>
              </div>
            </fieldset>
          </div>

          <div class="card-footer">
            <div style="display: flex; gap: 1rem; justify-content: flex-end;">
              <a href="/recados" class="btn btn-outline">Cancelar</a>
              <button type="submit" class="btn btn-primary" id="btnSalvar">
                游 Salvar Contato
              </button>
            </div>
          </div>
        </form>
      </div>

    </div>
  </main>

  <%- include('partials/footer', { scripts: ['/js/novo-recado.js'] }) %>
