<%- include('partials/header') %>
<body>
  <%- include('partials/navbar') %>

  <main class="main" role="main">
    <div
      class="container"
      data-message-permissions
      data-can-update="<%= permissions && permissions.updateMessages ? 'true' : 'false' %>"
      data-can-delete="<%= permissions && permissions.deleteMessages ? 'true' : 'false' %>"
      data-can-edit-own="<%= userRoleSlug === 'operator' ? 'true' : 'false' %>"
      data-can-forward="<%= permissions && permissions.updateMessages ? 'true' : 'false' %>"
      data-user-role="<%= userRoleSlug || 'reader' %>"
    >

      <% if (typeof csrfToken !== 'undefined' && csrfToken) { %>
        <meta name="csrf-token" content="<%= csrfToken %>">
      <% } %>

      <!-- Cabe√ßalho da p√°gina -->
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:2rem;">
        <div>
          <h1 style="font-size:2rem;font-weight:700;margin-bottom:0.5rem;"><%= title || 'Contatos' %></h1>
          <p style="color:var(--text-secondary);margin:0;">Filtre, visualize e gerencie os contatos</p>
        </div>
        <% if (permissions && permissions.createMessages) { %>
          <a href="/novo-recado" class="btn btn-primary btn-lg">‚ûï Novo Contato</a>
        <% } %>
      </div>

      <!-- Filtros -->
      <div class="card" style="margin-bottom:2rem;">
        <div class="card-header">
          <h2 class="card-title">Filtros</h2>
          <p class="card-subtitle">Refine a busca por per√≠odo, destinat√°rio e situa√ß√£o</p>
        </div>
        <div class="card-body">
          <form id="filtrosForm">
            <div class="filters-grid">
              <div class="form-group">
                <label for="start_date" class="form-label">Data In√≠cio</label>
                <input id="start_date" name="start_date" type="date" class="form-input">
              </div>

              <div class="form-group">
                <label for="end_date" class="form-label">Data Fim</label>
                <input id="end_date" name="end_date" type="date" class="form-input">
              </div>

              <div class="form-group">
                <label for="recipient" class="form-label">Destinat√°rio</label>
                <select id="recipient" name="recipient" class="form-input">
                  <option value="">Todos</option>
                  <% if ((destinatariosUsuarios || []).length) { %>
                    <optgroup label="Usu√°rios">
                      <% destinatariosUsuarios.forEach(function(user) { %>
                        <option value="<%= user.name %>">üë§ <%= user.name %></option>
                      <% }); %>
                    </optgroup>
                  <% } %>
                  <% if ((destinatariosSetores || []).length) { %>
                    <optgroup label="Setores">
                      <% destinatariosSetores.forEach(function(sector) { %>
                        <option value="<%= sector.name %>">üè¢ <%= sector.name %></option>
                      <% }); %>
                    </optgroup>
                  <% } %>
                </select>
              </div>

              <div class="form-group">
                <label for="status" class="form-label">Situa√ß√£o</label>
                <select id="status" name="status" class="form-input">
                  <option value="">Todas</option>
                  <option value="pending">Pendente</option>
                  <option value="in_progress">Em Andamento</option>
                  <option value="resolved">Resolvido</option>
                </select>
              </div>
            </div>

            <div class="form-actions" style="margin-top:1rem;display:flex;gap:1rem;">
              <button type="submit" class="btn btn-primary">Filtrar</button>
              <button type="reset" id="btnLimpar" class="btn btn-outline">Limpar</button>
            </div>
          </form>
        </div>
      </div>

      <!-- Resultados -->
      <div class="card">
        <div class="card-header">
          <h2 class="card-title">Resultados</h2>
          <p class="card-subtitle" id="totalResultados">Carregando...</p>
        </div>
        <div class="card-body">
          <div id="listaRecados" role="region" aria-live="polite">
            <div style="text-align:center;padding:2rem;color:var(--text-secondary);">
              <span class="loading"></span> Carregando contatos...
            </div>
          </div>
        </div>
        <div class="card-footer">
          <nav id="paginacao" class="pagination" aria-label="Pagina√ß√£o"></nav>
        </div>
      </div>

    </div>
  </main>

  <%- include('partials/footer', { scripts: ['/js/recados.js'] }) %>
