<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Recados - Dashboard</title>
    <link rel="stylesheet" href="/css/style.css">
</head>
<body>
    <header class="header">
        <div class="container">
            <div class="header-content">
                <a href="/" class="logo">üìû Sistema de Recados</a>
                
                <nav class="nav">
                    <a href="/" class="nav-link active">Dashboard</a>
                    <a href="/recados" class="nav-link">Recados</a>
                    <a href="/novo-recado" class="nav-link">Novo Recado</a>
                    <a href="/relatorios" class="nav-link">Relat√≥rios</a>
                </nav>

                <button class="mobile-menu-btn">‚ò∞</button>
            </div>
            
            <nav class="mobile-nav">
                <div class="nav">
                    <a href="/" class="nav-link active">Dashboard</a>
                    <a href="/recados" class="nav-link">Recados</a>
                    <a href="/novo-recado" class="nav-link">Novo Recado</a>
                    <a href="/relatorios" class="nav-link">Relat√≥rios</a>
                </div>
            </nav>
        </div>
    </header>

    <main class="main">
        <div class="container">
            <!-- Cabe√ßalho da p√°gina -->
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
                <div>
                    <h1 style="font-size: 2rem; font-weight: 700; margin-bottom: 0.5rem;">Dashboard</h1>
                    <p style="color: var(--text-secondary);">Vis√£o geral dos recados e liga√ß√µes</p>
                </div>
                <a href="/novo-recado" class="btn btn-primary btn-lg">
                    ‚ûï Novo Recado
                </a>
            </div>

            <!-- Cards de estat√≠sticas -->
            <div class="stats-grid" id="statsGrid">
                <div class="stat-card total">
                    <div class="stat-number" id="totalRecados">-</div>
                    <div class="stat-label">Total de Recados</div>
                </div>
                <div class="stat-card pendente">
                    <div class="stat-number" id="totalPendentes">-</div>
                    <div class="stat-label">Pendentes</div>
                </div>
                <div class="stat-card andamento">
                    <div class="stat-number" id="totalAndamento">-</div>
                    <div class="stat-label">Em Andamento</div>
                </div>
                <div class="stat-card resolvido">
                    <div class="stat-number" id="totalResolvidos">-</div>
                    <div class="stat-label">Resolvidos</div>
                </div>
            </div>

            <!-- Filtros r√°pidos -->
            <div class="card" style="margin-bottom: 2rem;">
                <div class="card-header">
                    <h2 class="card-title">Filtros R√°pidos</h2>
                    <p class="card-subtitle">Acesso r√°pido aos recados mais importantes</p>
                </div>
                <div class="card-body">
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem;">
                        <a href="/recados?situacao=pendente" class="btn btn-warning">
                            ‚è≥ Pendentes
                        </a>
                        <a href="/recados?situacao=em_andamento" class="btn btn-primary">
                            üîÑ Em Andamento
                        </a>
                        <a href="/recados?data_inicio=" class="btn btn-outline" id="btnHoje">
                            üìÖ Hoje
                        </a>
                        <a href="/recados?data_inicio=" class="btn btn-outline" id="btnSemana">
                            üìä Esta Semana
                        </a>
                    </div>
                </div>
            </div>

            <!-- Recados recentes -->
            <div class="card">
                <div class="card-header">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <div>
                            <h2 class="card-title">Recados Recentes</h2>
                            <p class="card-subtitle">√öltimos 10 recados registrados</p>
                        </div>
                        <a href="/recados" class="btn btn-outline btn-sm">Ver Todos</a>
                    </div>
                </div>
                <div class="card-body">
                    <div id="recadosRecentes">
                        <div style="text-align: center; padding: 2rem; color: var(--text-secondary);">
                            <div class="loading" style="margin: 0 auto 1rem;"></div>
                            Carregando recados...
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <script src="/js/app.js"></script>
    <script>
        // Configurar filtros r√°pidos com datas
        document.addEventListener('DOMContentLoaded', () => {
            const hoje = Utils.getCurrentDate();
            const semanaAtras = new Date();
            semanaAtras.setDate(semanaAtras.getDate() - 7);
            const semanaAtrasStr = semanaAtras.toISOString().split('T')[0];

            document.getElementById('btnHoje').href = `/recados?data_inicio=${hoje}&data_fim=${hoje}`;
            document.getElementById('btnSemana').href = `/recados?data_inicio=${semanaAtrasStr}&data_fim=${hoje}`;
        });

        // Carregar estat√≠sticas
        async function carregarEstatisticas() {
            try {
                const response = await API.getStats();
                const stats = response.data;

                document.getElementById('totalRecados').textContent = stats.total;
                document.getElementById('totalPendentes').textContent = stats.pendente;
                document.getElementById('totalAndamento').textContent = stats.em_andamento;
                document.getElementById('totalResolvidos').textContent = stats.resolvido;
            } catch (error) {
                console.error('Erro ao carregar estat√≠sticas:', error);
                Toast.error('Erro ao carregar estat√≠sticas');
            }
        }

        // Carregar recados recentes
        async function carregarRecadosRecentes() {
            try {
                const response = await API.getRecadosRecentes(10);
                const recados = response.data;

                const container = document.getElementById('recadosRecentes');

                if (recados.length === 0) {
                    container.innerHTML = `
                        <div style="text-align: center; padding: 2rem; color: var(--text-secondary);">
                            üìù Nenhum recado encontrado
                        </div>
                    `;
                    return;
                }

                const html = `
                    <div class="table-container">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Data/Hora</th>
                                    <th>Destinat√°rio</th>
                                    <th>Remetente</th>
                                    <th>Assunto</th>
                                    <th>Situa√ß√£o</th>
                                    <th>A√ß√µes</th>
                                </tr>
                            </thead>
                            <tbody>
                                ${recados.map(recado => `
                                    <tr>
                                        <td>
                                            <div style="font-weight: 500;">${Utils.formatDate(recado.data_ligacao)}</div>
                                            <div style="font-size: 0.75rem; color: var(--text-secondary);">${recado.hora_ligacao}</div>
                                        </td>
                                        <td style="font-weight: 500;">${recado.destinatario}</td>
                                        <td>${recado.remetente_nome}</td>
                                        <td>${Utils.truncateText(recado.assunto, 40)}</td>
                                        <td>
                                            <span class="badge badge-${recado.situacao.replace('_', '')}">${getSituacaoLabel(recado.situacao)}</span>
                                        </td>
                                        <td>
                                            <div style="display: flex; gap: 0.5rem;">
                                                <a href="/visualizar-recado/${recado.id}" class="btn btn-outline btn-sm">üëÅÔ∏è</a>
                                                <a href="/editar-recado/${recado.id}" class="btn btn-outline btn-sm">‚úèÔ∏è</a>
                                            </div>
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                `;

                container.innerHTML = html;
            } catch (error) {
                console.error('Erro ao carregar recados recentes:', error);
                document.getElementById('recadosRecentes').innerHTML = `
                    <div style="text-align: center; padding: 2rem; color: var(--error);">
                        ‚ùå Erro ao carregar recados
                    </div>
                `;
            }
        }

        // Obter label da situa√ß√£o
        function getSituacaoLabel(situacao) {
            const labels = {
                'pendente': 'Pendente',
                'em_andamento': 'Em Andamento',
                'resolvido': 'Resolvido'
            };
            return labels[situacao] || situacao;
        }

        // Inicializar p√°gina
        document.addEventListener('DOMContentLoaded', () => {
            carregarEstatisticas();
            carregarRecadosRecentes();

            // Atualizar dados a cada 30 segundos
            setInterval(() => {
                carregarEstatisticas();
                carregarRecadosRecentes();
            }, 30000);
        });
    </script>
</body>
</html>

